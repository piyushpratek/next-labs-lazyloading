<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lazy Loading Example</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-ZZRt6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1k8v2n2O2pzzz3k2b70b4"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div id="results" class="container text-center mt-5"></div>

    <div id="loading" class="container text-center mt-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p>Hang on, Loading Content</p>
    </div>

    <script>
      // Initialize variables
      const resultsContainer = document.getElementById('results');
      const loadingContainer = document.getElementById('loading');
      let currentPage = 1;
      const resultsPerPage = 10;
      let isLoading = false;

      // Function to fetch and display results
      function fetchResults() {
        isLoading = true;
        fetch(
          `https://jsonplaceholder.typicode.com/posts?_page=${currentPage}&_limit=${resultsPerPage}`
        )
          .then((response) => response.json())
          .then((data) => {
            data.forEach((post) => {
              const postElement = document.createElement('div');
              postElement.className = 'post';
              postElement.innerHTML = `<h3>${post.title}</h3><p>${post.body}</p>`;
              resultsContainer.appendChild(postElement);
            });
            isLoading = false;
            loadingContainer.style.display = 'none'; // Hide loading message
          })
          .catch((error) => {
            console.error('Error fetching data:', error);
            isLoading = false;
            loadingContainer.style.display = 'none'; // Hide loading message
          });
      }

      // Function to check if the user has reached the end of the page
      function isAtEndOfPage() {
        const windowHeight = window.innerHeight;
        const scrollTop = document.documentElement.scrollTop;
        const totalHeight = document.documentElement.scrollHeight;
        return totalHeight - (scrollTop + windowHeight) < 100; // Adjust this value for when to trigger loading more results
      }

      // Function to load more results when the user reaches the end of the page
      function loadMoreResults() {
        if (!isLoading && isAtEndOfPage()) {
          currentPage++;
          loadingContainer.style.display = 'block'; // Show loading message
          fetchResults();
        }
      }

      // Event listener for scrolling
      window.addEventListener('scroll', loadMoreResults);

      // Initial fetch of results
      fetchResults();
    </script>
  </body>
</html>
